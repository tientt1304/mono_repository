// Generated By XFlutter Cli.
//
// more info: https://xflutter-cli.com
import 'package:flutter/material.dart';
import 'package:animated_infinite_scroll_pagination/animated_infinite_scroll_pagination.dart';
import '../animations/customized_animated_widget.dart';
import '../loaders/loader.dart';
import 'pagination_load_widget.dart';
import 'pagination_error_widget.dart';

/// [C] a controller extends [AnimatedInfinitePaginationController]
/// [T] the Model of item
class InfiniteScrollView<T, C extends AnimatedInfinitePaginationController<T>> extends StatelessWidget {
  /// [controller] a class extends [AnimatedInfinitePaginationController]
  final C controller;

  /// [itemBuilder] callback return [Widget] with item [T].
  final Widget Function(BuildContext context, T item, int index) itemBuilder;

  /// pass [topWidgets] when you want to place a widget at the top of the first [itemBuilder] widget.
  final List<SliverCustomWidget>? topWidgets;

  /// [onRefresh] callback called when user swipe to refresh list.
  final Function()? onRefresh;

  /// [retry] callback called when pagination request failed and user press on [PaginationErrorWidget].
  final Function()? retry;

  /// wrap [ScrollView] in [RefreshIndicator] when [refreshIndicator] == `true`
  ///
  /// default value is `true`
  final bool refreshIndicator;

  /// Scroll Direction default value is [Axis.vertical]
  final Axis scrollDirection;

  /// A delegate that controls the layout of the children within the [GridView].
  final SliverGridDelegate? gridDelegate;

  /// Whether to spawn a new isolate on which to calculate the diff on.
  final bool? spawnIsolate;

  /// [noItemsWidget] is a widget appears after fetch first page data and the result is empty
  final Widget? noItemsWidget;

  /// [errorWidget] is a widget appears in the bottom of the scrollView when an exception thrown in [controller].
  final Widget? errorWidget;

  /// [footerLoadingWidget] is a widget appears when user scroll to bottom of the [AnimatedInfiniteScrollView] and the nextPage data is in loading state.
  final Widget? footerLoadingWidget;

  /// [loadingWidget] is a widget appears when first page is in loading state.
  final Widget? loadingWidget;

  /// {@macro flutter.rendering.RenderViewportBase.cacheExtent}
  final double? cacheExtent;

  /// {@macro flutter.material.Material.clipBehavior}
  ///
  /// Defaults to [Clip.hardEdge].
  final Clip clipBehavior;

  /// How the scroll view should respond to user input.
  /// If an explicit [ScrollBehavior] is provided to [scrollBehavior], the
  /// [ScrollPhysics] provided by that behavior will take precedence after
  /// [physics].
  final ScrollPhysics? physics;

  /// {@macro flutter.widgets.shadow.scrollBehavior}
  ///
  /// [ScrollBehavior] also provide [ScrollPhysics]. If an explicit
  /// [ScrollPhysics] is provided in [physics], it will take precedence,
  /// followed by [scrollBehavior], and then the inherited ancestor
  /// [ScrollBehavior].
  final ScrollBehavior? scrollBehavior;

  /// Whether the scroll view scrolls in the reading direction.
  final bool reverse;

  /// [AnimatedInfiniteScrollView] padding
  final EdgeInsets padding;

  /// key for access [AnimatedInfiniteScrollView] current [State]
  final GlobalKey<AnimatedInfiniteScrollViewState>? globalKey;

  /// build [AnimatedInfiniteScrollView] with basic configuration
  const InfiniteScrollView({
    required this.controller,
    required this.itemBuilder,
    this.refreshIndicator = true,
    this.loadingWidget,
    this.onRefresh,
    this.topWidgets,
    this.retry,
    this.errorWidget,
    this.scrollDirection = Axis.vertical,
    this.gridDelegate,
    this.spawnIsolate,
    this.noItemsWidget,
    this.cacheExtent,
    this.clipBehavior = Clip.hardEdge,
    this.padding = EdgeInsets.zero,
    this.physics,
    this.reverse = false,
    this.scrollBehavior,
    this.globalKey,
    this.footerLoadingWidget,
    super.key,
  });

  @override
  Widget build(BuildContext context) {
    return AnimatedInfiniteScrollView<T>(
      key: globalKey,
      controller: controller,
      options: AnimatedInfinitePaginationOptions(
        refreshIndicator: refreshIndicator,
        topWidgets: topWidgets,
        footerLoadingWidget: footerLoadingWidget ?? const Center(child: PaginationLoaderWidget()),
        loadingWidget: loadingWidget ?? const CustomizedAnimatedWidget(child: Loader()),
        errorWidget: errorWidget ??
            Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                PaginationErrorWidget(
                  retry: retry ?? () => controller.fetchNewChunk(page: controller.page),
                ),
              ],
            ),
        onRefresh: onRefresh,
        itemBuilder: itemBuilder,
        gridDelegate: gridDelegate,
        spawnIsolate: spawnIsolate,
        noItemsWidget: noItemsWidget,
        scrollDirection: scrollDirection,
        cacheExtent: cacheExtent,
        physics: physics,
        scrollBehavior: scrollBehavior,
        clipBehavior: clipBehavior,
        reverse: reverse,
        padding: padding,
      ),
    );
  }
}
